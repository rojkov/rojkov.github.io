<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="Dmitry Rozhkov"><title>What's behind Sailfish browser | Idempotent info</title><link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css"><link rel="canonical" href="http://idempotent.info/posts/whats-behind-sailfish-browser.html"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml"></head><body>
<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://idempotent.info/">Idempotent info</a>
    </div>
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav"><li><a href="../stories/about.html">About</a>
                </li><li><a href="../archive.html">Archives</a>
                </li><li><a href="../categories/index.html">Tags</a>
                </li><li><a href="../rss.xml">RSS</a>

        </li></ul><ul class="nav navbar-nav navbar-right"><li>
    <a href="whats-behind-sailfish-browser.rst" id="sourcelink">Source</a>
    </li>

        </ul></div><!-- /.navbar-collapse -->
</nav><!-- End of Menubar --><div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    <article class="postbox post-text"><div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">What's behind Sailfish browser</h1>

    <hr><small>
        Posted: <time class="published dt-published" datetime="2014-02-09T14:07:14+00:00" itemprop="datePublished">2014-02-09 14:07</time>
        

        
          |  
        More posts about 
    <span itemprop="keywords">
        <a class="tag p-category" href="../categories/gecko.html"><span class="badge badge-info">gecko</span></a>
        <a class="tag p-category" href="../categories/embedlite.html"><span class="badge badge-info">embedlite</span></a>
        <a class="tag p-category" href="../categories/sailfish.html"><span class="badge badge-info">sailfish</span></a>
    </span>


    </small>
    <hr><div class="e-content" itemprop="articleBody text">
    <div><p>In this post I'd like to shade some light on what technology is used in
the browser application for Sailfish OS.</p>
<p>By now it's a widely known fact that the browser is based on the Gecko engine
which is developed by Mozilla corp. and is used in their Firefox browser and
Firefox OS. For some reason it's not that known that the Sailfish browser is
built upon the <a class="reference external" href="https://github.com/tmeshkova/gecko-dev/tree/embedlite/embedding/embedlite">EmbedLite</a> embedding API (also known as IPCLiteAPI) for Gecko.</p>
<p>This embedding API started as a research project in Nokia by Oleg Romashin and
Andrey Petrov at the times when Nokia was still developing the Maemo platform.
Currently the project is maintained by Tatiana Meshkova.</p>
<p>It would help us a lot if the API made its way to the main Gecko repository and
became a part of the engine. Unfortunately this hasn't happened yet and the
current status of such integration you can see in these two bugs:</p>
<ol class="arabic simple"><li><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=746800">https://bugzilla.mozilla.org/show_bug.cgi?id=746800</a></li>
<li><a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=713681">https://bugzilla.mozilla.org/show_bug.cgi?id=713681</a></li>
</ol><p>Later on Oleg has implemented a Qt embedding library (<a class="reference external" href="https://github.com/tmeshkova/qtmozembed">qtmozembed</a>) that uses this API. And this library
has enabled the development of a very
<a class="reference external" href="https://github.com/tmeshkova/qmlmozbrowser">lightweight Qt-based alternative to the Fennec browser</a>
for the Nokia N9 mobile phone. Also this browser has been ported to the Nemo project and
packaged as <a class="reference external" href="https://build.merproject.org/package/show?package=cutefox-qt5&amp;project=nemo%3Adevel%3Aapps">Cutefox</a>. Thanks to Andrey Kozhevnikov (aka CODERus), Stephan Beyerle (aka Morpog),
Michael Demetriou (aka qwazix) and Ivaylo Dimitrov (aka freemangordon).
The Cutefox browser became a starting point for the Sailfish browser.</p>
<p>Now let's see how all these components work together.</p>
<p>This <a class="reference external" href="https://wiki.mozilla.org/Embedding/IPCLiteAPI">page</a>
breifly describes the architecture of EmbedLite API. The key points are:</p>
<ul class="simple"><li>Native UI and Gecko engine live in different threads. Theoretically they can
live in different processes thanks to Mozilla's <a class="reference external" href="https://developer.mozilla.org/en-US/docs/IPDL/Tutorial">IPDL</a>.</li>
<li>Rendering is based on
<a class="reference external" href="https://wiki.mozilla.org/Platform/GFX/OffMainThreadCompositing#Design">off main thread compositing</a>
which provides multi-threaded responsive rendering. The same as in Firefox OS
and Firefox for Android.</li>
<li>XUL is not used.</li>
</ul><p>Basically EmbedLite provides API to:</p>
<ul class="simple"><li>start/terminate the Gecko engine in a separate thread/process;</li>
<li>create/destroy a web view;</li>
<li>install a toolkit specific listeners to receive events generated inside Gecko
in the native UI;</li>
<li>send messages/events from the native UI to Gecko;</li>
<li>get/set Gecko preferences;</li>
<li>load XPCOM components needed for features implemented in the native UI.</li>
</ul><p>This functionality is exposed with two main classes: <cite>EmbedLiteApp</cite> and <cite>EmbedLiteView</cite>.
<cite>EmbedLiteApp</cite> represents the Gecko engine. Only one instance of this class is allowed
to be created. <cite>EmbedLiteView</cite> represents a web view naturally. It's possible to create
many instances of this class.</p>
<p>Also EmbedLite defines two interfaces for toolkit specific
listeners: <cite>EmbedLiteAppListener</cite> and <cite>EmbedLiteViewListener</cite>. An implementor of a
toolkit specific embedding is supposed to implement listeners inhereting to those
interfaces. Particularly the Qt embedding I mentioned above implements these two
listeners in the classes <cite>QMozContextPrivate</cite> (derived from <cite>EmbedLiteAppListener</cite>)
and <cite>QGraphicsMozViewprivate</cite> (derived from <cite>EmbedLiteViewListener</cite>).</p>
<p>The Sailfish browser doesn't know anything about all these details. They are hidden
inside qtmozbed's interface classes:</p>
<ol class="arabic simple"><li><cite>QMozContext</cite> which encapsulates the web engine (via <cite>QMozContextPrivate</cite>);</li>
<li><cite>QuickMozView</cite> which encapsulets a web view (via <cite>QGraphicsMozViewPrivate</cite>) and
provides declarative QtQuick interface. In other words it can be used as a QML
component in your Qt application.</li>
</ol><p>Here's a bit outdated static model:</p>
<a class="reference external image-reference" href="../images/qtembed.png"><img alt="/images/qtembed.png" src="../images/qtembed.png"></a>
<p>In the next post I'll describe in more details what happens when EmbedLite is initialized
and a web view gets created.</p></div>
    </div>
    </div>
    

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="idempotent",
            disqus_url="http://idempotent.info/posts/whats-behind-sailfish-browser.html",
        disqus_title="What's behind Sailfish browser",
        disqus_identifier="cache/posts/whats-behind-sailfish-browser.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article></div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:rozhkov@idempotent.com">Dmitry Rozhkov</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
        </footer></div>
</div>


            <script src="../assets/js/all-nocdn.js" type="text/javascript"></script><script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script></body></html>