<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="">
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="generator" content="Hugo 0.59.0" />
        <title>  | Dmitry Rozhkov</title>
        <meta name="description" content="">
        <meta itemprop="name" content="">
        <meta itemprop="description" content="">
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:image" content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200">
        <meta property="og:url" content="https://rojkov.github.io/">
        <meta property="og:site_name" content="Dmitry Rozhkov"><meta property="og:type" content="website">
        <link rel="icon" type="image/png" href="https://rojkov.github.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://rojkov.github.io/favicon-16x16.png" sizes="16x16">

	
	  <link href="/" rel="alternate" type="application/rss+xml" title="Dmitry Rozhkov" />
	  <link href="/" rel="feed" type="application/rss+xml" title="Dmitry Rozhkov" />
	

        
        
        
        
        <link rel="stylesheet" href="/sass/combined.min.2072f0ef1b87081e9ca5011a6a085bb666600ca54c1aa4d1e43a7c03b09b3cf7.css">

        

        
    </head>
    <body class="bilberry-hugo-theme">
        
<nav>

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="https://rojkov.github.io/page/about/">About</a></li>
                
            
        </ul>

        
    </div>
</nav>


        <header>
    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?d=mm&size=200" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a href="/">Dmitry Rozhkov</a></h3>
            
        </div>

    <div class="languages">
                
                    
                        <a href="/en" class="active">en</a>
                    
                
                    
                        <a href="/ru">ru</a>
                    
                
            </div>
        

        
        <div class="toggler">
        
            <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
    </div>
</header>


        <div class="main container">
            



    

    
        
    <div class="article-wrapper u-cf">
        
            <a class="bubble" href="https://rojkov.github.io/posts/how-maemo-products-were-developed/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="https://rojkov.github.io/posts/how-maemo-products-were-developed/">How Maemo Products Were Developed</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2019-10-21</span>
            
        

        

        

        
    </div>

    
        <p>Any project that goes beyond being a mere personal hobby is always a
collective effort where people work in concert. And these people
working in concert is the foundation on which any product is built.
Means of production are useless without people, but people need to
be organized, their relations have to be structured to transform
the collective effort into a meaningful outcome.</p>

<p>I used to be a part of the <a href="https://en.wikipedia.org/wiki/Maemo">Maemo</a>
project at Nokia. In this post I&rsquo;d like to write down what I still remember
about the ways the products like <a href="https://en.wikipedia.org/wiki/Nokia_N9">Nokia N9</a>
were developed.</p>

<p>Usually people&rsquo;s relations are structured with agreed policies.
The policies are enforced either through organizational hierarchies or
special tools. The more policy enforcement relies on tools the less
is the need for managers managing the hierarchies.</p>

<p>At Nokia the hierarchical structure was huge and had more than one
dimension.</p>

<p>Perhaps it makes sense to start with <em>platforms</em>. It is a very loaded
term, but at Nokia &ldquo;platform&rdquo; was used mostly to denote a base operating
system on which products were built. There were <a href="https://en.wikipedia.org/wiki/Series_40">S40</a>,
<a href="https://en.wikipedia.org/wiki/Series_60">S60</a>, WindowsPhone and
Maemo platforms. So strictly speaking Maemo was not a project,
but platform. Every platform had its own big boss.</p>

<p>Then we had <em>programs</em> for the platforms. A program was led by a
program manager. Programs were defined by base hardware configurations.</p>

<p>And in the scope of a program (meaning on top of a base hardware configuration)
<em>products</em> where developed, that is devices of slightly different hardware
versions and flashable images for them. A product also included &ldquo;maintenance&rdquo;
that is software updates for the released device. Obviously every product
had its own product manager reporting to the program manager and responsible
for her product&rsquo;s timely releases with certain functionality.</p>

<p>In addition to that there were configuration managers responsible for
product configurations targeting different markets. For example the Maps
application for Nokia N9 selling in Iran knew nothing about Israel,
users in China saw Taiwan as PRC&rsquo;s territory and so on. In some funny
markets the Camera app must produce &ldquo;shutter&rdquo; sound when taking a
picture, so the setting for disabling the sound must be excluded.</p>

<p>Non-managers (also known as developers) were organized in <em>teams</em>.
Every team was responsible for development of one subsystem of
the platform. Examples are the Real-time Communication team, the Applications
team (Calculator, Gallery and others), the Application Framework team
(UI and non-UI libraries), the Imaging team (Camera), the Browser team,
the Multimedia team (sound processing and playback), the System Software
team (Kernel and hardware adaptation) and others. Besides that there were
auxiliary teams that didn&rsquo;t deliver any functionality to products, but
supported the main teams. Without them products would be never released:</p>

<ul>
<li>the SDK team (toolchains, cross-compilers);</li>
<li>the Performance team (optimizations and fixing performance issues);</li>
<li>the Release &amp; Integration team. Probably this was the most important
team which developed the policy enforcement tools mentioned in
the beginning of the post, maintained Maemo&rsquo;s CI system when Martin
Fowler had not yet coined the term and started to practice GitOps
long before WeaveWorks. All this made it possible to integrate the
deliverables of all other teams automatically (to some extent)
into an end product. Later the team members formed the core of Jolla.</li>
</ul>

<p>Naturally every team was led by a line manager who did budgeting, facilitating
and performance assessments.</p>

<p>Inside the teams there were project managers who served as an interface
between team members and product managers (teams delivered features to
multiple products at the same time) and communicated with other teams
because e.g. Applications depend on Application Framework, Phone depends
on Multimedia and Camera (for video calls), almost everything depends
Hardware Adaptation and everybody needs SDK.</p>

<p>Also I&rsquo;d like to mention product QA, UX designers, industrial designers,
sourcing, sales, marketing.</p>

<p>In other words in 2000s it could cost a fortune to develop new
mobile phones. But the good news is that a substantial part of the
developed code was made open. Combined with the experience
accumulated by the people it enabled Jolla to develop its own
mobile platform way cheaper. Needless to say Jolla&rsquo;s organizational
structure was almost flat, it relied heavily on its automated
release process.</p>
    
</div>

    
<div class="footer no-tags">


    

    
</div>

</article>

        
    </div>

    
        
    <div class="article-wrapper u-cf">
        
            <a class="bubble" href="https://rojkov.github.io/posts/debugging-kubernetes-deployment/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="https://rojkov.github.io/posts/debugging-kubernetes-deployment/">Debugging a Kubernetes Deployment</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2018-09-09</span>
            
        

        

        

        
    </div>

    
        <p>When looking for a Kubernetes issue I could investigate I stumbled upon
this <a href="https://github.com/kubernetes/kubernetes/issues/67515">problem</a>.
The title should have been worded as something like &laquo;A new mysterious
<code>ReplicaSet</code> replaces the original one soon after its <code>Deployment</code> has
been created&raquo;. What&rsquo;s important is that this new <code>ReplicaSet</code> fails
to start.</p>

<p>In hindsight the case seems rather trivial, but at the time I saw the
issue it didn&rsquo;t feel like that. The first suspect was the code of
Kubernetes mistakenly firing up an unneeded <code>ReplicaSet</code>, thus I needed
a way to hunt down the culprit in the code.</p>

<p>How do people debug such issues? Isn&rsquo;t there a proven methodology, a more
or less systematic approach to solving similar puzzles. I&rsquo;m not aware
of any. <a href="https://github.com/kubernetes/kubernetes/issues/67515#issuecomment-415481314">Not only me</a>
is asking such questions it seems. So, I decided to copy my comment
from the issue discussion to this blog.</p>

<p>My style of debugging is trial and error led by my intuition. But here
is the scheme I usually use:</p>

<ol>
<li><p>Reproduce the issue locally. Usually this is the most time consuming
step.</p></li>

<li><p>Look into all available logs for anything weird or strange (nothing
interesting here this time).</p></li>

<li><p>Try to build an older version of Kubernetes, as old as possible. And see
if the issue is reproducible. Then in case it&rsquo;s not use <code>git bisect</code> to
find the offending commit. Unfortunately the issue is reproducible even
with K8s 1.8.0.</p></li>

<li><p>Examine the content of the objects in question (<code>ReplicaSet</code>s) using
<code>kubectl describe ...</code>. How objects of the same type differ from each
other. If some objects are mutable try to find out how their content
gets updated (<code>Deployment</code>). Here I found out that the new replica set lacks
tolerations and the deployment is not immutable.</p></li>

<li><p>Find the code which runs upon deployment updates and increase its log
verbosity. It turned out the relevant code is the deployment controller
of <code>kube-contoller-manager</code>. This environment variable increases log
verbosity for the code <code>LOG_SPEC=deployment_controller*=5,replica_set*=5,sync*=5,recreate*=5</code>.
The only outcome on this step was the confirmation that the deployment
gets updated.</p></li>

<li><p>Modify the sync handler for <code>Deployment</code> objects to log what exactly has
changed (this lib can be used to do the diff <a href="https://github.com/d4l3k/messagediff">https://github.com/d4l3k/messagediff</a>).
Here we see that the only change was the removal of the tolerations.</p></li>

<li><p>Look for code which actually does update <code>Deployment</code> through the API server
with this command</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ git grep Deployments | grep <span style="color:#d14">&#34;Update(&#34;</span></code></pre></div>
<p>There are only few places in Kubernetes where <code>Deployment</code>s get updated,
but none looks relevant. This leads to the hypothesis that the source of
the update is somewhere outside of Kubernetes.</p></li>

<li><p>Take a closer look at the YAML files. They seem to be quite complex.</p></li>

<li><p>Try to make the setup as simple as possible where the issue is still
reproducible. Here I found that small one line changes in different YAML
files lead to the issue being not reproducible - the setup is too fragile.</p></li>

<li><p>Then look through the YAMLs line by line in the hope to find something
interesting. The interesting bit here is that the deployment operates
on behalf of the <code>kube-state-metrics</code> service account which requests
permission to do <code>update</code> on <code>Deployment</code>s.</p></li>

<li><p>Drop this permission. This confirms that the Deployment doesn&rsquo;t
change any more.</p></li>

<li><p>Look into the logs of the running pod. Bingo! In <code>addon-resizer</code>&rsquo;s logs
there is an error about inability to update the <code>Deployment</code>.</p></li>

<li><p>Try to find the sources of <code>addon-resizer:1.0</code>. This turned out to be
not easy task, because the version 1.0 is <strong>very</strong> old. Apparently the
culprit is K8s API has evolved too much since v1.0. Looking at <code>PodSpec</code>
used in <code>addon-resizer:1.0</code> confirms it.</p></li>
</ol>

<p>So, it turned out the problem is in the outdated container image
<code>quay.io/coreos/addon-resizer:1.0</code> of the deployment.</p>

<p>It runs a client which updates the <code>kube-state-metrics</code> deployment. But the
client uses outdated API which lacks <code>Tolerations</code> in <code>PodSpec</code>. As result
the updated deployment looses tolerations in its pod template. The deployment
controller recreates <code>ReplicaSet</code>. The pods controlled by the new <code>ReplicaSet</code>
lack tolerations as well and fail to run on the tainted node.</p>
    
</div>

    
<div class="footer no-tags">


    

    
    <div class="languages">
        <i class="fa fa-language"></i>
        <div class="links">
            
                <a href="https://rojkov.github.io/ru/posts/debugging-kubernetes-deployment/">ru</a>
            
        </div>
    </div>
    
</div>

</article>

        
    </div>

    
        
    <div class="article-wrapper u-cf">
        
            <a class="bubble" href="https://rojkov.github.io/posts/how-to-configure-devel-environment-to-work-on-gecko-for-sailfishos/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="https://rojkov.github.io/posts/how-to-configure-devel-environment-to-work-on-gecko-for-sailfishos/">How to Configure Devel Environment to Work on Gecko for Sailfishos</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2014-03-20</span>
            
        

        

        

        
    </div>

    
        <p>It turned out that newcomers have difficulties with setting up their development
environment to work on Gecko integration with Nemo, SailfishOS or any other
Mer-based Linux. Hence this post.</p>

        
            <a href="https://rojkov.github.io/posts/how-to-configure-devel-environment-to-work-on-gecko-for-sailfishos/" class="more">Continue reading</a>
        
    
</div>

    
<div class="footer no-tags">


    

    
</div>

</article>

        
    </div>

    
        
    <div class="article-wrapper u-cf">
        
            <a class="bubble" href="https://rojkov.github.io/posts/embedlite-initialization/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="https://rojkov.github.io/posts/embedlite-initialization/">EmbedLite Initialization</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2014-03-02</span>
            
        

        

        

        
    </div>

    
        <p>I guess some people may find useful the couple of words below on how
EmbedLite embedding is initialized. I&rsquo;ve written them mostly because I&rsquo;m trying
to wrap my head around the topic myself. So please let me know if you see non-sense.</p>

        
            <a href="https://rojkov.github.io/posts/embedlite-initialization/" class="more">Continue reading</a>
        
    
</div>

    
<div class="footer no-tags">


    

    
</div>

</article>

        
    </div>

    
        
    <div class="article-wrapper u-cf">
        
            <a class="bubble" href="https://rojkov.github.io/posts/whats-behind-sailfish-browser/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="https://rojkov.github.io/posts/whats-behind-sailfish-browser/">What&#39;s Behind Sailfish Browser</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2014-02-09</span>
            
        

        

        

        
    </div>

    
        <p>In this post I&rsquo;d like to shade some light on what technology is used in
the browser application for Sailfish OS.</p>

<p>By now it&rsquo;s a widely known fact that the browser is based on the Gecko engine
which is developed by Mozilla corp. and is used in their Firefox browser and
Firefox OS. For some reason it&rsquo;s not that known that the Sailfish browser is
built upon the <a href="https://github.com/tmeshkova/gecko-dev/tree/embedlite/embedding/embedlite">EmbedLite</a>
embedding API (also known as IPCLiteAPI) for Gecko.</p>

        
            <a href="https://rojkov.github.io/posts/whats-behind-sailfish-browser/" class="more">Continue reading</a>
        
    
</div>

    
<div class="footer no-tags">


    

    
</div>

</article>

        
    </div>

    

    
    <div class="paginator">
        

        
    </div>



        </div>

        
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <strong>Latest posts</strong>
                <ul>
                
                    <li>
                        <a href="https://rojkov.github.io/posts/how-maemo-products-were-developed/">How Maemo Products Were Developed</a>
                    </li>
                
                    <li>
                        <a href="https://rojkov.github.io/posts/debugging-kubernetes-deployment/">Debugging a Kubernetes Deployment</a>
                    </li>
                
                    <li>
                        <a href="https://rojkov.github.io/posts/how-to-configure-devel-environment-to-work-on-gecko-for-sailfishos/">How to Configure Devel Environment to Work on Gecko for Sailfishos</a>
                    </li>
                
                    <li>
                        <a href="https://rojkov.github.io/posts/embedlite-initialization/">EmbedLite Initialization</a>
                    </li>
                
                    <li>
                        <a href="https://rojkov.github.io/posts/whats-behind-sailfish-browser/">What&#39;s Behind Sailfish Browser</a>
                    </li>
                
                </ul>
        </div>
        

        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                
                
                
                
                
                
                
                
                
                
            </div>
            

            <div class="languages">
                    <strong>Other languages</strong>
                    
                        
                            <a href="/en" class="active">en</a>
                        
                    
                        
                            <a href="/ru">ru</a>
                        
                    
                </div>
            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/Lednerb" target="_blank">
                &copy;
                
                    2018
                
                by Lednerb
            </a>
	    -
		<a href="https://rojkov.github.io/index.xml">RSS</a>
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme" target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


        

        

        
        
        <script type="text/javascript" src="/js/externalDependencies.39c47e10e241eae2947b3fe21809c572.js" integrity="md5-OcR&#43;EOJB6uKUez/iGAnFcg=="></script>

        
        
        <script type="text/javascript" src="/js/theme.ff50ae6dc1bfc220b23bf69dbb41b54e.js" integrity="md5-/1CubcG/wiCyO/adu0G1Tg=="></script>

        <script>
            $(".moment").each(function() {
                $(this).text(
                    moment( $(this).text() )
                        .locale( "en" )
                        .format('LL')
                );
            });

            $(".footnote-return sup").html("");
        </script>

        

        


    </body>
</html>
